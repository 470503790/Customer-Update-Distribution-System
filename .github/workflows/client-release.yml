name: Client-Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:

env:
  DOTNET_VERSION: ${{ vars.DOTNET_VERSION }}
  COS_SECRET_ID: ${{ secrets.COS_SECRET_ID }}
  COS_SECRET_KEY: ${{ secrets.COS_SECRET_KEY }}
  COS_REGION: ${{ secrets.COS_REGION }}
  COS_BUCKET: ${{ secrets.COS_BUCKET }}
  SIGN_PFX_BASE64: ${{ secrets.SIGN_PFX_BASE64 }}
  SIGN_PFX_PASSWORD: ${{ secrets.SIGN_PFX_PASSWORD }}

jobs:
  build-client:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}
      - name: Restore (placeholder)
        run: echo "TODO: dotnet restore for client"
      - name: Build (placeholder)
        run: echo "TODO: dotnet build -c Release"
      - name: Test (placeholder)
        run: echo "TODO: dotnet test -c Release"
      - name: Sign binaries (placeholder)
        run: echo "TODO: sign binaries with provided certificate"
      - name: Package client (placeholder)
        shell: pwsh
        run: echo "TODO: Compress-Archive packaged client artifacts"
      - uses: actions/upload-artifact@v4
        with:
          name: client-release
          path: |
            update-agent_*.zip
            update-tray_*.zip

  publish-cos:
    runs-on: ubuntu-latest
    needs: build-client
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: client-release
          path: ./client-packages
      - name: Upload to COS (placeholder)
        run: echo "TODO: upload client packages to $COS_BUCKET"
